<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Atlanta Personal Injury Attorney - Amircani Law</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="description" content="Atlanta personal injury attorneys at Amircani Law fight for maximum compensation for injury victims. Experienced representation for car accidents, truck accidents, and wrongful death. Call (678) 280-7389" />
    <link rel="icon" type="image/png" href="/amircani-fav.png" />
    <!-- WhatConverts Tracking -->
    <script>var $wc_load=function(a){return  JSON.parse(JSON.stringify(a))},$wc_leads=$wc_leads||{doc:{url:$wc_load(document.URL),ref:$wc_load(document.referrer),search:$wc_load(location.search),hash:$wc_load(location.hash)}};</script>
    <script src="//s.ksrndkehqnwntyxlhgto.com/102959.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-783764209"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-783764209');
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Roboto:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap");
    </style>
    <link href="tailwind.css" rel="stylesheet" />
    <link href="tailwind.css" rel="stylesheet" />
    <script type="module">
      import { initializeFirstTouchTracking, getCurrentTrackingData, logTrackingDebug } from '/src/lib/tracking.ts';

      initializeFirstTouchTracking();

      logTrackingDebug();

      const pageLoadTime = Date.now();

      function populateTrackingFields() {
        const trackingData = getCurrentTrackingData();
        const timeOnPage = Math.round((Date.now() - pageLoadTime) / 1000);

        const fieldMappings = {
          utm_source: trackingData.source,
          utm_medium: trackingData.medium,
          utm_campaign: trackingData.campaign,
          utm_term: trackingData.term,
          utm_content: trackingData.content,
          gclid: trackingData.gclid,
          fbclid: trackingData.fbclid,
          msclkid: trackingData.msclkid,
          first_utm_source: trackingData.firstUtmSource,
          first_utm_medium: trackingData.firstUtmMedium,
          first_utm_campaign: trackingData.firstUtmCampaign,
          first_utm_term: trackingData.firstUtmTerm,
          first_utm_content: trackingData.firstUtmContent,
          first_referrer: trackingData.firstReferrer,
          first_landing_page: trackingData.firstLandingPage,
          first_visit_timestamp: trackingData.firstVisitTimestamp,
          referrer: trackingData.referrer,
          referrer_domain: trackingData.referrerDomain,
          search_engine: trackingData.searchEngine,
          social_platform: trackingData.socialPlatform,
          traffic_source_category: trackingData.trafficSourceCategory,
          is_paid_traffic: trackingData.isPaidTraffic.toString(),
          is_returning_visitor: trackingData.isReturningVisitor.toString(),
          lead_source: trackingData.source,
          lead_medium: trackingData.medium,
          lead_campaign: trackingData.campaign,
          lead_keyword: trackingData.term,
          lead_content: trackingData.content,
          landing_url: trackingData.landingPage,
          landing_page: trackingData.landingPage,
          current_page_url: trackingData.currentPageUrl,
          session_id: trackingData.sessionId,
          session_count: trackingData.sessionCount.toString(),
          pages_visited: trackingData.pagesVisited.toString(),
          time_on_page: timeOnPage.toString(),
          user_agent: trackingData.userAgent,
          device_type: trackingData.deviceType,
          browser: trackingData.browser,
          os: trackingData.os,
          screen_resolution: trackingData.screenResolution,
          timestamp: trackingData.timestamp
        };

        Object.keys(fieldMappings).forEach(function(fieldId) {
          const field = document.getElementById(fieldId);
          if (field) {
            field.value = fieldMappings[fieldId] || '';
          }
        });

        console.log('✅ Form fields populated with tracking data');
      }

      function handleFormSubmit(event) {
        populateTrackingFields();

        const form = event.target;
        const sourceField = form.querySelector('#utm_source');
        const mediumField = form.querySelector('#utm_medium');

        if (sourceField && mediumField) {
          const source = sourceField.value;
          const medium = mediumField.value;

          const illogicalCombinations = [
            { source: 'direct', medium: 'organic' },
            { source: 'direct', medium: 'referral' },
            { source: 'direct', medium: 'social' },
            { source: 'direct', medium: 'cpc' }
          ];

          for (const combo of illogicalCombinations) {
            if (source === combo.source && medium === combo.medium) {
              console.error('❌ Form validation failed: Illogical attribution combination detected');
              console.error('Source:', source, 'Medium:', medium);
              alert('Error: Invalid tracking data detected. Please contact support.');
              event.preventDefault();
              return false;
            }
          }

          console.log('✅ Form validation passed');
          console.log('Submitting with Source:', source, 'Medium:', medium);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          populateTrackingFields();
          const form = document.getElementById('contact-form');
          if (form) {
            form.addEventListener('submit', handleFormSubmit);
          }
        });
      } else {
        populateTrackingFields();
        const form = document.getElementById('contact-form');
        if (form) {
          form.addEventListener('submit', handleFormSubmit);
        }
      }

      document.addEventListener('focusin', function(e) {
        if (e.target.form && e.target.form.id === 'contact-form') {
          setTimeout(populateTrackingFields, 100);
        }
      });
    </script>
  </head>
  <body>
    <!-- Hidden form for Netlify detection -->
    <form name="amircani-contact" netlify netlify-honeypot="bot-field" hidden>
      <input type="text" name="name" />
      <input type="email" name="email" />
      <input type="tel" name="phone" />
      <textarea name="message"></textarea>
      <input type="text" name="bot-field" />
    </form>

    <div id="app"></div>
    <script type="module" src="./src/index.tsx"></script>
  </body>
</html>
